/* v3.5.0 by emonitor Team. Released under the MIT License. */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r(e.emonitor={})}(this,function(e){"use strict";var r=Object.prototype.toString,t=Object.prototype.hasOwnProperty,n=function(e){return"[object Array]"===r.call(e)},o=function(e){return"[object Object]"===r.call(e)},i=function(e){return"[object PerformanceTiming]"===r.call(e)},a=function(e){return"[object Error]"===r.call(e)},c=function(e){return"string"==typeof e},s=function(e){return void 0===e},d=function(e){return"function"==typeof e},u=function(e){return"number"==typeof e},l=function(e,r){return t.call(e,r)},p=function(e){if(!e)return{};var r=document.createElement("a");return r.href=e,{host:r.host,path:r.pathname,hostname:r.hostname,protocol:r.protocol.slice(0,-1)}},f={duration:"delay",name:"resurl",type:"type"},m=["007","all"],v=["pecker","all"],h=["beacon"],g=["disable"],y=["link","css","script","img","video","audio"],w=["cdn","cgi"],_=["jserror","console","ajax","fetch","script","link","promise","img","audio","video"],b=["hh_ref","s_url","s_host","s_path","s_protocol","s_browser","s_os","s_app","s_ptag"],x={cgi:{values:["delay"],dimensions:["cgipath","cgihost","bizcode_server","cgiurl","httpcode","bizcode"].concat(b)},pagepf:{values:["time_dns","time_tcp","time_response","time_firstpaint","time_domready","time6","time7","time8"],dimensions:[].concat(b)},cdn:{values:["delay"],dimensions:["resurl","reshost","respath","httpcode","type"].concat(b)},error:{values:[],dimensions:["err_type"].concat(b)},flowlog:{values:[],dimensions:["log"].concat(b)},slowlog:{values:["duration"],dimensions:["name"].concat(b)}},k=["bizmsg"],S=["1xx","2xx","3xx","4xx","5xx"],E=[".js",".css"],q={pagepf:"page",cgi:"cgi",cdn:"cdn",flowlog:"flowlog",slowlog:"slowlog"},j={vconsoleSdk:"https://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/vconsole/3.0.0/vconsole.min.js",beaconSdk:"https://beaconcdn.qq.com/sdk/3.0.7/beacon_web.min.js",delay:2e3,maxtimeout:1e4,mode:"pecker",pecker:{page:"https://btrace.qq.com/kvcollect?BossId=6529&Pwd=1714580587",error:"https://btrace.qq.com/kvcollect?BossId=6527&Pwd=1102151080",slowlog:"https://btrace.qq.com/kvcollect?BossId=6523&Pwd=1202531240",cgi:"https://btrace.qq.com/kvcollect?BossId=6528&Pwd=96045012",resource:"https://btrace.qq.com/kvcollect?BossId=6958&Pwd=1123576360",flowlog:"https://btrace.qq.com/kvcollect?BossId=6526&Pwd=878966364"},atta:{flowlog:"https://h.trace.qq.com/kv?attaid=0ac00014962&token=7952797182",cgi:"https://h.trace.qq.com/kv?attaid=02000014960&token=2225483334",error:"https://h.trace.qq.com/kv?attaid=05000014957&token=2765844177",page:"https://h.trace.qq.com/kv?attaid=01600014956&token=8318937558",cdn:"https://h.trace.qq.com/kv?attaid=06600014961&token=3913518181",slowlog:"https://h.trace.qq.com/kv?attaid=03700014959&token=8958877272"},beacondomain:["oth.eve.mdt.qq.com:8080","oth.eve.mdt.qq.com","jrlt.beacon.qq.com"],cgi:{sampling:.01,baseUrl:"https://btrace.qq.com/kvcollect?BossId=6528&Pwd=96045012",code:["ret","code","retcode"],msg:["info","result","msg"],jsonp:function(e){return!e||!/\.js/.test(e.src)},headers:!1},logs:{sampling:1,baseUrl:"https://btrace.qq.com/kvcollect?BossId=6526&Pwd=878966364"},cdn:{sampling:1},pluginNames:["Ajax","Error","Console","Fetch","Jsonp","Beacon","UrlParams"]},T=["s_path","s_uuid","s_traceid","s_guid","s_appid","s_vuserid","hc_pgv_pvid","s_omgid","err_desc","time_firstpaint","time_domready","s_openid","s_qq","hh_ref","s_nick","cgipath"],O=function(e){var r=String(e).toLowerCase();return{isReversed007:-1!==m.indexOf(r)||-1!==r.indexOf("007"),isReversedPecker:-1!==v.indexOf(r)||-1!==r.indexOf("pecker"),isReversedBeacon:-1!==h.indexOf(r)||-1!==r.indexOf("beacon"),isReversedDisable:-1!==g.indexOf(r)}},A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},R=(function(){function e(e){this.value=e}function r(r){function t(o,i){try{var a=r[o](i),c=a.value;c instanceof e?Promise.resolve(c.value).then(function(e){t("next",e)},function(e){t("throw",e)}):n(a.done?"return":"normal",a.value)}catch(e){n("throw",e)}}function n(e,r){switch(e){case"return":o.resolve({value:r,done:!0});break;case"throw":o.reject(r);break;default:o.resolve({value:r,done:!1})}(o=o.next)?t(o.key,o.arg):i=null}var o,i;this._invoke=function(e,r){return new Promise(function(n,a){var c={key:e,arg:r,resolve:n,reject:a,next:null};i?i=i.next=c:(o=i=c,t(e,r))})},"function"!=typeof r.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(r.prototype[Symbol.asyncIterator]=function(){return this}),r.prototype.next=function(e){return this._invoke("next",e)},r.prototype.throw=function(e){return this._invoke("throw",e)},r.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}),M=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),C=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},I=function(){function e(e,r){var t=[],n=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(n=(a=c.next()).done)&&(t.push(a.value),!r||t.length!==r);n=!0);}catch(e){o=!0,i=e}finally{try{!n&&c.return&&c.return()}finally{if(o)throw i}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),B=function(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)},P=function(e){try{var r=Number(e);if(isNaN(r)||"number"!=typeof r)return 0;if(r>=0&&r<1e4)return r;if(r>=1e4&&r<1e5)return 1e4}catch(e){console.warn("transformNum "+e)}return 0},U=function(){},L=function(e){var r=e.name,t=e.url,n=void 0===t?window.location.href:t;r=r.replace(/[[\]]/g,"\\$&");var o=new RegExp("[?&]"+r+"(=([^&#]*)|&|#|$)").exec(n);return o&&o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):""},N=function(e){for(var r=encodeURIComponent(e)+"=",t=document.cookie.split(";"),n=0;n<t.length;n++){for(var o=t[n];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(r))return decodeURIComponent(o.substring(r.length,o.length))}return null},Q=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return Math.random()<=e},D=function(e,r,t){var n=null;return function(){for(var o=arguments.length,i=Array(o),a=0;a<o;a++)i[a]=arguments[a];var c=this;clearTimeout(n),n=setTimeout(function(){e.apply(c,i),"function"==typeof t&&t()},r)}},J=function(e){var r=Number(e);if(isNaN(r))return"unknown";var t="2xx";return e<200?t="1xx":e>=200&&e<300?t="2xx":e>=300&&e<400?t="3xx":e>=400&&e<500?t="4xx":e>=500&&(t="5xx"),t},z=function(e){var r=[];for(var t in e)r.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return r.join("&")},H=function(e){var r=[];if(Array.isArray(e))r=e.map(function(e){if(o(e)){var r=e||{},t=r.value,n=void 0===t?0:t,i=r.count,a=void 0===i?1:i,c=r.policy;return{value:n,count:a,policy:void 0===c?"AVG":c}}});else if(o(e)){var t=e||{},n=t.value,i=void 0===n?0:n,a=t.count,c=void 0===a?1:a,s=t.policy;return[{value:i,count:c,policy:void 0===s?"AVG":s}]}return r},F=function(e){return c(e)?[e]:Array.isArray(e)?e:[]},W=function(e){var r=""+e;return r.lastIndexOf("_")===r.length-1?r:e+"_"},X=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments[2],n=e||{},o=n.type,i=n.source,a=r||{},c=a.name,u=void 0===c?"":c,l=a.prefiex,p=void 0===l?"cmjn_emonitor":l,f=a.onDimension,m=void 0===f?function(e){if("hh_ref"===e)return""}:f,v=-1!==_.indexOf(o)?"error":o,h=x[v]||{},g=h.values,y=void 0===g?[]:g,w=h.dimensions,b=void 0===w?[]:w,q=u;u||(q="");var j="cdn"===v,T={logname:p+"_"+(q=W(u))+("pagepf"===v?"page":v),content:[]},O={dimensions:[],values:[{value:1,count:1,policy:"SUM"}]};if(y.forEach(function(e){var r=i[e];O.values.push({value:P(r),count:1,policy:"AVG"})}),b.forEach(function(e){var r=i[e],t=-1!==["s_url","cgiurl","resurl"].indexOf(e)?String(r).split("?")[0]:r;k.indexOf(e);if(j){var n=i.resurl;if(!E.some(function(e){return-1!==n.indexOf(e)})&&"resurl"===e)t="";else if("type"===e){var o=-1!==n.indexOf(".css"),a=-1!==n.indexOf(".js");o?t="link":a&&(t="script")}}d(m)&&!s(m(e))&&(t=m(e)),O.dimensions.push(t)}),"cgi"===v){var A=i.httpcode,R=J(A);S.forEach(function(e){var r=e===R;O.values.push({value:r?1:0,count:1,policy:"SUM"})})}else"error"===v&&_.forEach(function(e){var r=o===e;O.values.push({value:r?1:0,count:1,policy:"SUM"})});if(d(t))try{var M,I,U=t(C({},e,{log:T}))||{},L=U.values,N=U.dimensions;(M=O.values).push.apply(M,B(H(L))),(I=O.dimensions).push.apply(I,B(F(N)))}catch(e){console.warn("onCustom "+e)}return O.time=(new Date).getTime(),T.content.push(O),C({},i,{content:JSON.stringify({log:[T]})})},$=function(e){var r=q[e];return r||-1===_.indexOf(e)?r:"error"},V=function(e){var r=e.type,t=e.source,n=e.attaUrls,o=e.mode,i=x[r]||-1!==_.indexOf(r),a=!0;if("cdn"===r){var c=t.resurl,s=void 0===c?"":c;a=E.some(function(e){return-1!==s.indexOf(e)})}var d=$(r),u=O(o).isReversed007,l=i&&a&&n[d]&&u;return l?$(r):l},G=function(){var e=new Image;return e.onerror=function(){e=null},e.onload=function(){e=null},e},K=function(e){var r=e.url,t=e.data;try{var n=null;(n=window.XMLHttpRequest?new XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP")).open("POST",r,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send(z(t))}catch(e){console.warn("xmlhttp error",e)}},Y=function(e,r){return L({name:e,url:r})},Z=function(e){var r=e.baseUrl,t=e.data,n=e.method,i=void 0===n?"GET":n,a=e.atta,c=void 0===a?{}:a,s=e.mode,u=void 0===s?"pecker":s,l=e.onCustom,p=t||{},f=p.type,m=p.source,v=(c||{}).baseUrl,h=o(v)?C({},j.atta,v):j.atta,g=V({type:f,source:m,attaUrls:h,mode:u}),y=O(u),w=y.isReversedPecker;if(y.isReversedBeacon){var _=X(t,c,l);o(window._emonitorBeacon)&&d(window._emonitorBeacon.onDirectUserAction)&&window._emonitorBeacon.onDirectUserAction("rqd_emonitor",_)}if("GET"===i){if(g){var b=G(),x=h[g];b.src=x+"&"+z(X(t,c,l))}w&&(G().src=r+"&"+z(m))}else if("POST"===i){if(g){var k=h[g],S=Y("attaid",k),E=Y("token",k);K({url:"https://h.trace.qq.com/kv",data:C({},X(t,c,l),{attaid:S,token:E})})}if(w){var q=Y("BossId",r),T=Y("Pwd",r);K({url:"https://btrace.qq.com/kvcollect",data:C({},m,{BossId:q,Pwd:T})})}}},ee=function(e){var r=[];return n(e)&&e.forEach(function(e){var t={};for(var n in e)if(f[n]&&(t[f[n]]=e[n],"resurl"===f[n])){var o=p(e[n]),i=o.hostname,a=o.path;t.reshost=i,t.respath=a,t.httpcode=200}r.push(t)}),r},re=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t={};if(o(r))for(var n in r)-1!==T.indexOf(String(n))?t[n]=r[n]:console.warn(n,"could not be modify.");return C({},e,t)},te=function(){var e="";try{if(e=window.localStorage.getItem("emonitor.hc_pgv_pvid"))return e;var r=(new Date).getTime();return e="ek"+[r,Math.floor(r*Math.random()*Math.random()).toString().slice(-5)].join(""),window.localStorage.setItem("emonitor.hc_pgv_pvid",e),e}catch(r){return console.warn("emonitor.hc_pgv_pvid get error",r),e}},ne=function(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=void 0;return String(r).split(".").forEach(function(r){try{n=void 0!==n?n[r]:e[r]}catch(e){n=void 0}}),void 0===n?t:n},oe=function(e,r){var t=e.data,i=void 0===t?{}:t,a=e.path,s=void 0===a?"":a,d="",u=[];if(o(i)){if(c(s))return ne(i,s,"");if(n(s))return s.forEach(function(e){if(""!==ne(i,e,"")){if(!r)return d=ne(i,e),!1;u.push(e+":"+ne(i,e))}}),r&&(d=u.join(",")),d}return""},ie=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=r||{},n=t.code,i=t.msg,a={};if(o(e))a=e;else try{a=JSON.parse(e)}catch(e){a={}}return{bizcode:oe({data:a,path:n}),bizmsg:oe({data:a,path:i},r.mergeMsg)}},ae=function(e){var r="";if(!c(e))return console.warn("name is not string"),r;try{return 0===(r=L({name:e})).length&&(r=N(e)||""),r}catch(e){return console.error("Automatically get the value of the corresp onding name from the url or\n      cookie "+e),r}},ce=function(e){var r="unknown",t="unknown",n="unknown",o="unknown",i="unknown",a=e.toLowerCase();if(a.indexOf("windows")>-1?i="windows":a.indexOf("linux")>-1?i="linux":a.indexOf("mac")>-1&&(i="mac"),window.opera)o=window.opera.version(),t=window.opera.version(),n="opera";else if(/AppleWebKit\/(\S+)/.test(e))if(o=RegExp.$1,n="webkit",/Chrome\/(\S+)/.test(e))t=RegExp.$1,r="chrome";else if(/Version\/(\S+)/.test(e))t=RegExp.$1,r="safari";else{var c=parseFloat(o);t=c<100?1:c<312?1.2:c<412?1.3:2,r="safari"}else/KHTML\/(\S+)/.test(e)||/Konqueror\/([^;]+)/.test(e)?(o=RegExp.$1,t=RegExp.$1,n="khtml",r="konq"):/rv:([^)]+)\) Gecko\/\d{8}/.test(e)?(o=RegExp.$1,n="gecko",/Firefox\/(\S+)/.test(e)&&(t=RegExp.$1,r="firefox")):/MSIE ([^;]+)/.test(e)&&(o=RegExp.$1,t=RegExp.$1,n="ie",r="ie");return{machine:"PC",name:r,version:t,engineVer:o,engine:n,machineSys:i}},se=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:navigator.userAgent,r=ce(e),t=r.machineSys,n={mac:"mac"===t,version:r.engineVer,name:t},o={},i={iphone:e.match(/(iphone)\s(os\s)?([\d_]+)/i),ipad:e.match(/(ipad).*\s([\d_]+)/i),ipod:e.match(/(ipod).*\s([\d_]+)/i),android:e.match(/(android)\s([\d.]+)/i),windows:e.match(/Windows(\s+\w+)?\s+?(\d+\.\d+)/)};if(i.ipod&&(n.ios=!0,n.ipod=!0,n.version=i.ipod[2].replace(/_/g,"."),n.name="ipod"),i.ipad&&(n.ios=!0,n.ipad=!0,n.version=i.ipad[2].replace(/_/g,"."),n.name="ipad"),i.iphone&&(n.iphone=!0,n.ios=!0,n.version=i.iphone[3].replace(/_/g,"."),n.name="iphone"),i.android){var a=I(i.android,3)[2];n.android=!0,n.version=a,n.name="android"}if(i.windows){var c=I(i.windows,3)[2];n.windows=!0,n.version=c,n.name="windows"}var s={WEISHI:e.match(/weishi_(\d+?\.\d+?\.\d+?)/i),YYB:e.match(/\/qqdownloader\/(\d+)(?:\/(appdetail|external|sdk))?/i),mojii:e.match(/mojii/i),IE:e.match(/; msie\b|; trident\b|\bedge\//i),WeChat:e.match(/MicroMessenger\/((\d+)\.(\d+))\.(\d+)/)||e.match(/MicroMessenger\/((\d+)\.(\d+))/),MQQClient:!e.match(/QQReader/)&&e.match(/QQ\/(\d+\.\d+)/i)||e.match(/V1_AND_SQ_([\d.]+)/),MQQReader:e.match(/QQReader/i),QQvideo:!e.match(/TADChid/)&&e.match(/QQLiveBrowser\/([\d.]+)/),QQHDvideo:e.match(/QQLiveHDBrowser\/([\d.]+)/),TBSSDK:e.match(/MQQBrowser\/(\d+\.\d+)/i)&&e.match(/MSDK\/(\d+\.\d+)/),MQQBrowser:e.match(/MQQBrowser\/(\d+\.\d+)/i),UCBrowser:e.match(/ucbrowser\/(\d+\.\d+)/i),Qzone:e.match(/Qzone\/[\w\d_]*(\d\.\d)[.\w\d_]*/i),Weibo:e.match(/Weibo/i),qqnews:e.match(/qqnews\/(\d+\.\d+\.\d+)/i),QQLiveBroadcast:e.match(/QQLiveBroadcast/i),kuserAgentibao:e.match(/qnreading\/(\d+\.\d+\.\d+)/i),liebao:e.match(/LieBaoFast\/(\d+\.\d+\.\d+)/i),baiduboxapp:e.match(/baiduboxapp\/(\d+\.\d+\.\d+)/i),IEMobile:e.match(/IEMobile(\/|\s+)(\d+\.\d+)/)||e.match(/WPDesktop/),douban:e.match(/com\.douban\.frodo\/(\d+\.\d+\.\d+)/i),MiuiBrowser:e.match(/MiuiBrowser\/(\d+\.\d+)/i),BingPreview:e.match(/BingPreview\/(\d+\.)/i),TADChid:e.match(/TADChid\/(\d+)/i),Chrome:n.ios?e.match(/CriOS\/(\d+\.\d+)/):e.match(/Chrome\/(\d+\.\d+)/),Safari:e.match(/Safari\/(\d+\.\d+)/),sukan:e.match(/synopsis/i),qmkege:e.match(/qmkege\/(\d+\.\d+)/)};if(s.MQQReader)o.MQQReader=!0,o.version=1,o.name="MQQReader";else if(s.IEMobile)o.IEMobile=!0,o.version=1,o.name="IEMobile";else for(var d in s)if(s[d]){o[d]=!0,o.version=s[d][1]||0,o.name=d;break}return{browser:o,os:n}},de=/^(http|ftp|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-.,@?^=%&amp;:/~+#]*[\w\-@?^=%&amp;/~+#])?/,ue={},le=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U;if(de.test(e)&&!ue[e])try{ue[e]=e;var t=document.createElement("script");t.src=e,t.async=!0,t.charset="utf-8",t.onload=d(r)?r:U,t.onreadystatechange=function(){"complete"===this.readyState&&d(r)&&r()},t.onerror=function(){ue[e]=!1},document.getElementsByTagName("head")[0].appendChild(t)}catch(e){console.error("vConsole script load err")}},pe=function(e){var r=e.appkey,t=e.versionCode,n=e.channelID,o=e.openid,i=e.isDebug,a=e.delay,c=void 0===a?2e3:a,s=e.onReportSuccess,d=void 0===s?U:s,u=e.onReportFail,l=void 0===u?U:u;return le(j.beaconSdk,function(){ue.beaconInjected||(ue.beaconInjected=!0,window._emonitorBeacon=new window.BeaconAction({appkey:r,versionCode:t,channelID:n,openid:o,isDebug:i,delay:c,onReportSuccess:d,onReportFail:l}))})},fe=function(){var e=(new Date).getTime();return window.performance&&window.performance.now&&(e=window.performance.now()),e},me=function(e){var r={type:"",url:"",code:"",isErr:!1,source:e};if(!o(e))return r;if(l(e,"err_type")){r.type=e.err_type;try{if(e.err_desc){var t=JSON.parse(e.err_desc);r.url=t.url||t.fileName||e.s_url}else r.url=e.s_url}catch(t){r.url=e.s_url,console.warn(t)}r.isErr=!0}else l(e,"cgiurl")?(r.type="cgi",r.url=e.cgiurl,r.code=e.httpcode):l(e,"resurl")?(r.type="cdn",r.url=e.resurl,r.code=e.httpcode):l(e,"time_domready")?(r.type="pagepf",r.url=e.s_url,r.code=200):l(e,"json_entries")?(r.type="slowlog",r.url=e.s_url,r.code=200):l(e,"log")&&(r.type="flowlog",r.url=e.s_url,r.code=200);return r},ve=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window;return d(e)?function(){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];try{e.apply(r,n)}catch(e){console.error("wrapTryCatch "+e)}}:e},he=function(){var e=navigator.userAgent.toLowerCase().match(/micromessenger\/(\d+)\.(\d+)\.(\d+)/)||[];return!!I(e,1)[0]},ge=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=(e||{}).wx,n=(void 0===t?{}:t)||{},i=n.timeOrigin,a=n.info,c=u(i)&&o(a),s=he(),d=c&&s;return!!r&&(d?i:d)},ye=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var r=window.performance||window.webkitPerformance||window.msPerformance||window.mozPerformance,t=(o(e)?e:{}).wxpre,n=void 0!==t&&t;if(!r)return!1;var a=(r||{}).timing;if(!a||!i(a))return!1;var c=ge(r,n)||a.fetchStart,s={};return s.time_response=a.responseStart-a.requestStart,s.time_firstpaint=a.responseEnd-a.responseStart,s.time_domready=a.domContentLoadedEventStart-a.responseEnd,s.time_readyStart=a.fetchStart-a.navigationStart,s.time_redirectTime=a.redirectEnd-a.redirectStart,s.time_appcacheTime=a.domainLookupStart-a.fetchStart,s.time_dns=a.domainLookupEnd-a.domainLookupStart,s.time_tcp=a.connectEnd-a.connectStart,s.time_requestTime=a.responseEnd-a.requestStart,s.time_initDomTreeTime=a.domInteractive-a.responseEnd,s.time_loadEventTime=a.loadEventEnd-a.loadEventStart,s.time6=a.domLoading-c,s.time7=a.loadEventEnd-c,s.time8=a.domComplete-a.domInteractive,s}catch(e){return console.warn("err",e),{}}},we=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.name,t=e.type;try{if(!window.performance||!window.performance.getEntries)return console.warn("prerformance is not supported"),[];var n=performance.getEntries(),o=[];if(!n&&!n.length)return o;try{n.forEach(function(e){var r={name:e.name,time_redirect:e.redirectEnd-e.redirectStart,time_dns:e.domainLookupEnd-e.domainLookupStart,time_requestTime:e.responseEnd-e.requestStart,time_tcp:e.connectEnd-e.connectStart,type:e.initiatorType,starttime:Math.floor(e.startTime),entryType:e.entryType,duration:Math.floor(e.duration)||0,decodedBodySize:e.decodedBodySize||0,nextHopProtocol:e.nextHopProtocol,json_entries:JSON.stringify(e)};o.push(r)})}catch(e){console.error("get resourceTiming err::::",e)}return r?o.filter(function(e){return e.name===r})[0]:t?o.filter(function(e){return e.type===t}):o}catch(e){return console.warn("get performance happen error"),[]}},_e=function(){var e={};return y.forEach(function(r){e[r]=ee(we({type:r}))}),e},be=function(){var e=we(),r=[];try{if(Array.isArray(e))for(var t=e.length,n=0;n<t;n++){var o=e[n],i=o.starttime,a=o.duration,c=o.name;r.push(i+"|"+a+"|"+c)}}catch(e){console.warn("get Resource "+e)}return r},xe=function(e){var r=_e();for(var t in r)r[t].length>0&&r[t].forEach(function(r){e.config({baseUrl:j.pecker.resource}).send(r)})},ke=function(e){var r=new Headers;return e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var t=e.split(":"),n=t.shift().trim();if(n){var o=t.join(":").trim();r.append(n,o)}}),r},Se=function(e){if(!e)return!1;var r=se(navigator.userAgent).browser;if(["IE","IEmobile"].indexOf(r.name)<0)return!1;try{return ke(e.getAllResponseHeaders()||"").get("X-Request-URL")}catch(e){return console.warn("get IEUrl "+e),!1}},Ee=function(e){try{if(!e)return null;var r=e.responseType,t=e.response,n=void 0===t?null:t,o=e.responseText,i=void 0===o?null:o;if(-1!==["","text"].indexOf(r))return i;if("json"===r)return n}catch(e){console.warn("getResponse "+e)}},qe=function(e){var r={};try{var t=e.getAllResponseHeaders();if(null===t||""===t)return r;t.trim().split(/[\r\n]+/).forEach(function(e){var t=e.split(": "),n=t.shift(),o=t.join(": ");r[n]=o})}catch(e){console.error("get ajax header error. "+e)}return r},je=function(e){var r={};if(!e||!e.headers)return r;try{var t=!0,n=!1,o=void 0;try{for(var i,a=e.headers.entries()[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var c=i.value;r[c[0]]=c[1]}}catch(e){n=!0,o=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw o}}}catch(e){console.error("get fetch header error. "+e)}return r},Te=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U;if("object"===("undefined"==typeof WeixinJSBridge?"undefined":A(WeixinJSBridge))&&"function"==typeof window.WeixinJSBridge.invoke)"function"===d(e)&&e();else{var r=!1,t=function(){r||(r=!0,d(e)&&e())};document.addEventListener?(document.addEventListener("WeixinJSBridgeAuthChanged",t,!1),document.addEventListener("WeixinJSBridgeReady",t,!1)):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",t),document.attachEvent("onWeixinJSBridgeReady",t))}},Oe={SCRIPT:"script",LINK:"link",IMG:"img",AUDIO:"audio",VIDEO:"video",FETCH:"fetch",AJAX:"ajax",PROMISE:"promise"},Ae=function(){function e(){R(this,e);for(var r=arguments.length,t=Array(r),n=0;n<r;n++)t[n]=arguments[n];var o=t[0],i=this,a={onProxy:function(e){return ve(e,i)},debug:function(e){return e||ae("debug")}};Object.keys(o).forEach(function(e){var r=o[e];i[e]=d(a[e])?a[e](r):r})}return M(e,[{key:"init",value:function(){var e=this;try{j.pluginNames.forEach(function(r){e["proxy"+r]()})}catch(r){e.send({err_msg:"emonitor init happen error "+r,err_stack:""+r.stack,err_type:"jserror",err_function:"emonitor init func"})}}},{key:"proxyBeacon",value:function(){var e=this.mode,r=this.beacon,t=O(e).isReversedBeacon,n=(r||{}).appkey;if(t&&n)return pe(r)}},{key:"proxyUrlParams",value:function(){var e=this;e.params.forEach(function(r){e.options[r]=L({name:r})});var r=(e.options||{}).qq;"string"==typeof r&&r.length>0&&(e.options.openid="")}},{key:"proxyConsole",value:function(){var e=this;if("undefined"!=typeof console&&"function"==typeof console.error){var r=console.error;console.error=function(){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];r.apply(window.console,n),e.send({err_msg:n.join(","),level:"error",err_type:"console"})}}}},{key:"log",value:function(){var e=this,r=e.logs||{},t=r.baseUrl,n=r.sampling,i=void 0===n?1:n;if(t){for(var a={level:"",log:""},c=arguments.length,s=Array(c),d=0;d<c;d++)s[d]=arguments[d];s.length>1?a={level:s[0],log:s[1]}:o(s[0])?a=s[0]:console.warn("log params is empty"),Math.random()<=i&&e.send(C({},a),!1,t)}}},{key:"reportCgi",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=this,t=r.cgi||{},n=t.baseUrl,o=t.sampling,i=void 0===o?1:o;if(n){var a=e.cgiurl,c=p(a),s=c.host,d=c.path;Math.random()<=i&&r.send(C({cgipath:d,cgihost:s,bizcode_server:""},e),!1,n)}}},{key:"proxyAjax",value:function(){var e=Object.create(null),r=this,t=r.onProxy,n=(new Date).getTime(),o=null,i=null,a=function(e,t){i=fe();try{var a={},c=e&&(e.currentTarget||e.target),s=c.emonitorAjaxURL,d=c.emonitorAjaxSendTime||n,u=e.headers||{},l="",p="";c&&(l=c.status,p=c.responseURL||Se(c)||s);var f=Ee(c);if("timeout"===String(t))return a={err_msg:"ajax请求错误",err_stack:"错误码:"+l,level:"error",err_type:Oe.AJAX,err_code:l,err_desc:JSON.stringify({fileName:p,category:"ajax",text:"ajax request timeout",status:l}),headers:u},r.send(C({},a)),void(a={});var m=ie(f,r.cgi),v=m.bizcode,h=m.bizmsg;try{r.reportCgi({cgiurl:p,delay:Math.round(Math.max(i-d,0)),httpcode:l,bizcode:v,bizmsg:h,starttime:o,headers:u})}catch(e){console.warn(e)}"number"==typeof l&&(l<200||l>=300)&&(a={err_msg:"ajax请求错误",err_stack:"错误码:"+l,level:"error",err_type:Oe.AJAX,err_code:l,err_desc:JSON.stringify({fileName:p,category:"ajax",text:c.statusText,status:l}),headers:u},r.send(C({},a)),a={})}catch(e){console.error("Ajax handleEvent "+e)}};e.send=XMLHttpRequest.prototype.send,e.open=XMLHttpRequest.prototype.open,XMLHttpRequest.prototype.open=function(r,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e.open.apply(this,[r,t,n]),this.emonitorAjaxURL=t},XMLHttpRequest.prototype.send=function(i){o=(new Date).getTime(),n=fe(),this.emonitorAjaxSendTime=n;var c=this.onloadend,s=this.ontimeout,u=r.cgi,l=((void 0===u?{}:u)||{}).headers,p=void 0!==l&&l;this.onloadend=function(e){var r=p?qe(this):{};a(C(e,{headers:r})),"function"==typeof c&&c.apply(this,arguments)},this.ontimeout=function(e){var r=p?qe(this):{};a(C(e,{headers:r}),"timeout"),"function"==typeof s&&s.apply(this,arguments)},d(t)&&t({type:"ajax",data:i,extra:{url:this.emonitorAjaxURL}}),e.send.apply(this,[i])}}},{key:"proxyFetch",value:function(){var e=this,r=this.onProxy;if(d(window.fetch)){var t=window.fetch;window.fetch=function(){for(var n=arguments.length,o=Array(n),i=0;i<n;i++)o[i]=arguments[i];var a=(new Date).getTime(),s=fe(),u=s;return t.apply(void 0,o).then(function(t){u=fe();var n=e.cgi.headers?je(t):{};t.ok||""===t.url||e.send({err_msg:"fetch not ok",err_type:Oe.FETCH,err_code:t.status,err_desc:JSON.stringify({type:"error",fileName:o[0],options:o[1],category:"fetch"}),headers:n});var i="",l="",p=!0;try{var f=t.headers?t.headers.get("content-type"):"";c(f)&&-1!==f.indexOf("application/json")&&t.clone().json().then(function(c){try{d(r)&&r({type:"fetch",data:c,extra:{url:t.url||o[0]}});var f=ie(c,e.cgi)||{},m=f.bizcode,v=f.bizmsg;u=fe(),i=m,l=v,e.reportCgi({cgiurl:o[0],delay:Math.round(Math.max(u-s,0)),httpcode:t.status,bizcode:i,bizmsg:l,starttime:a,headers:n})}catch(e){p=!1,i="",l="",console.warn(e)}}).catch(function(e){p=!1,console.error("getCgiInfo",e)})}catch(e){p=!1,console.error("getCgiInfo",e)}try{p||e.reportCgi({cgiurl:o[0],delay:Math.round(Math.max(u-s,0)),httpcode:t.status,bizcode:i,bizmsg:l,starttime:a,headers:n})}catch(e){console.warn(e)}return t}).catch(function(r){e.send({err_msg:"fetch not ok",err_stack:""+r,err_type:Oe.FETCH,err_desc:JSON.stringify({type:"error",fileName:o[0],options:o[1],category:"fetch"}),headers:{}})})}}}},{key:"proxyError",value:function(){var e=this,r=this;window.addEventListener("error",function(e){var t=e.target?e.target:e.srcElement;if(t!==window&&t.nodeName&&Oe[t.nodeName.toUpperCase()]){var n={err_msg:t.localName+" is load error",err_stack:"resource is not found",err_type:""+t.localName,err_desc:JSON.stringify({tagName:t.localName,type:e.type,fileName:t.currentSrc||t.src||t.href,category:"resource"}),timestamps:(new Date).getTime()};r.send(C({},n))}},!0);var t=window.onerror;window.onerror=function(n,o,i,a,c){for(var s=arguments.length,u=Array(s>5?s-5:0),l=5;l<s;l++)u[l-5]=arguments[l];if("Script error."===n&&!o)return!1;var p={};return setTimeout(function(){var e=a||window.event&&window.event.errorCharacter||0;(p=c&&c.stack?{err_msg:n,err_stack:c.stack,err_type:"jserror"}:{err_msg:n,err_stack:"",err_type:"jserror"}).err_desc=JSON.stringify({url:r.URL,fileName:o,category:"javascript",line:i,col:e}),r.send(C({},p))},0),d(t)?t.apply(e,[n,o,i,a,c].concat(u)):!r.debug},window.addEventListener("unhandledrejection",function(e){var t={err_msg:a(e.reason)?e.reason.message:e.reason,err_type:Oe.PROMISE,err_desc:JSON.stringify({url:location.href,category:"promise"}),err_stack:a(e.reason)?e.reason.stack:e.reason||"promise is error"};r.send(C({},t)),e.preventDefault()},!0)}},{key:"proxyJsonp",value:function(){var e=this,r=window.document.createElement,t=function(r,t){var n=e.cgi.jsonp,o=void 0!==n&&n;if("function"==typeof o&&o(r)||"boolean"==typeof o&&o){var i="load"===t.type?200:500,a=p(r.src),c=a.host,s=a.path;e.reportCgi({cgiurl:r.src,delay:Math.round(Math.max(fe()-r.emonitorJsonpFetchBeginTime,0)),httpcode:i,bizcode:"",bizmsg:"",cgipath:s,cgihost:c,starttime:r.emonitorJsonpFetchStartTime})}r.emonitorJsonpFetchStartTime=null,r.emonitorJsonpFetchBeginTime=null};window.document.createElement=function(){var e=r.apply(this,arguments);return"script"===arguments[0]&&(e.emonitorJsonpFetchBeginTime=fe(),e.emonitorJsonpFetchStartTime=(new Date).getTime(),e.addEventListener("load",function(r){return t(e,r)},!0),e.addEventListener("error",function(r){return t(e,r)},!0)),e}}},{key:"config",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var r in e)-1!==["baseUrl","params","options","sampling","delay","name","cgi"].indexOf(String(r))&&(this[r]=e[r]);return this}},{key:"send",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=arguments[2],n=this,i=(n.cgi||{}).btrace,a=void 0!==i&&i,c=n.mode,s=e.err_type||"console";if(Q(n.sampling)){var u="jserror"===s?300:n.delay,l=D(Z,u,U),f=p(location.href),m=f.host,v=f.path,h=f.protocol,g=se(navigator.userAgent),y=g.browser,_=g.os,b=C({},this.options,e,{timestamps:(new Date).getTime(),_dc:Math.random(),dtime:(new Date).getTime(),hh_ua:navigator.userAgent,hh_uav:y.version,hh_ref:document.referrer||"",hc_pgv_pvid:te(),s_url:location.href,s_host:m,s_path:v,s_protocol:h,s_browser:y.name,s_os:_.name,s_qq:ae("qq")||ae("uin"),s_openid:ae("openid"),s_app:n.name,s_ptag:n.ptag||ae("ptag")||ae("ADTAG")}),x=n.onBeforeSend,k=n.onCustom,S={};if(d(x))try{var E=x(S=me(b));if("boolean"==typeof E&&!E)return;var q=O(n.mode).isReversedBeacon;if("cgi"===S.type&&q&&-1!==j.beacondomain.indexOf(S.source.cgihost))return;if("img"===S.type&&S.url===S.source.s_url)return;if(-1!==w.indexOf(S.type)){var T=p(S.url).hostname;if(-1!==["h.trace.qq.com","btrace.qq.com"].indexOf(T)&&!a)return}o(E)&&(b=re(b,E))}catch(e){console.warn(e)}var A=S,R=A.isErr,M=A.type;l({baseUrl:t||n.baseUrl,data:{isErr:R,type:M,source:b},method:r?"POST":"GET",atta:n.atta||{},mode:c,onCustom:k})}}}]),e}(),Re=p;e.create=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.options,t=void 0===r?{}:r,n=e.cgi,i=void 0===n?j.cgi:n,a=e.logs,c=void 0===a?j.logs:a,s=e.cdn,u=void 0===s?j.cdn:s,l=e.atta,p=void 0===l?{}:l,f=e.baseUrl,m=void 0===f?j.pecker.error:f,v=e.sampling,h=void 0===v?1:v,g=e.name,y=void 0===g?"unknown":g,w=e.params,_=void 0===w?[]:w,b=e.ptag,x=void 0===b?"":b,k=e.debug,S=void 0===k||k,E=e.onBeforeSend,q=void 0===E?U:E,T=e.onCustom,A=void 0===T?U:T,R=e.onProxy,M=void 0===R?U:R,I=e.onLoad,B=void 0===I?U:I,P=e.maxTimeout,L=void 0===P?j.maxtimeout:P,N=e.delay,Q=void 0===N?j.delay:N,D=e.mode,J=void 0===D?j.mode:D,z=e.onMaxTimeOut,H=void 0===z?U:z,F=e.beacon,W=void 0===F?{}:F,X=e.perf,$=void 0===X?{}:X,V=!1,G=C({},j.cgi,i),K=C({},j.logs,c),Y=new Ae({options:t,baseUrl:m,params:_,delay:Q,name:y,sampling:h,cgi:G,atta:p,ptag:x,debug:S,onBeforeSend:q,logs:K,mode:J,onProxy:M,onCustom:A,beacon:W,cdn:u});O(J).isReversedDisable||Y.init(),setTimeout(function(){if(d(H))try{H(j)}catch(e){console.warn("onMaxTimeOut "+e)}if(!V)try{var e=be();Y.config({baseUrl:j.pecker.slowlog}).send({json_entries:JSON.stringify(e)},!0),Y.config({baseUrl:j.pecker.error})}catch(e){console.warn("emonitorIns send",e)}},L);var Z=o($)?$:{},ee=Z.pfCb,re=Z.hook,te=!!d(re)&&re();return window.addEventListener("load",function(){setTimeout(function(){if(!V){te?Te(function(){if(Y.config({baseUrl:j.pecker.page}).send(ye($)),d(ee))try{ee()}catch(e){console.warn("pfCb",e)}V=!0}):Y.config({baseUrl:j.pecker.page}).send(ye($));var e=(u||{}).sampling,r=void 0===e?0:e;Math.random()<=Number(r)&&xe(Y),Y.config({baseUrl:j.pecker.error}),V=!0,d(B)&&B()}},0)},!1),Y},e.getRcTiming=we,e.getPfTiming=ye,e.getCdnTiming=_e,e.getSysInfo=se,e.getUrlParam=L,e.getCookie=N,e.getLinkInfo=Re,e.injectVconsole=function(){return le(j.vconsoleSdk,function(){ue.vcInjected||(ue.vcInjected=new window.VConsole)})},Object.defineProperty(e,"__esModule",{value:!0})});
